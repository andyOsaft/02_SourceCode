//--------------------------------------------------------------------------------------------------------------

//#define		F_CPU 3686400
#include	<avr\io.h>
#include	<util\delay.h>
#include 	<stdbool.h>

#define		BIT0	0
#define		BIT1	1
#define		BIT2	2
#define		BIT3	3
#define		BIT4	4
#define		BIT5	5
#define		BIT6	6
#define		BIT7	7	

bool lcd_dimmer_is_init=false;
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	wait_ms(...) - Wartet einige Millisekunden
//	PE:	milliSec=Anzahl der zu wartenden Millisekunden
//--------------------------------------------------------------------------------------------------------------
/*
void	wait_ms(int milliSec)
{
	_delay_loop_2(1*(F_CPU/(1000/4))*milliSec); 	// 4 Zyklen Warteschleife
}

void 	wait_us(int mikroSec)
{
	_delay_loop_2(1*(F_CPU/(1000000/4)) * mikroSec);	// 4 Zyklen Warteschleife
}
*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------

//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_send(...) - sendet ein Byte an LCD im 4-Bit-Modus
//	RS muss vorher richtig gesetzt sein
//	PE:	data= zu sendendes Byte
//--------------------------------------------------------------------------------------------------------------
/*void lcd_send(char data)
{
	//aktuelles RS ermitteln
	char rs=PORTD;
	rs &= 4;

	//High-Teil senden
	char tmp=data;
	tmp &= 0xf0;
	tmp |= rs;
	PORTD =tmp;

	//Schreibsignal
	PORTD |= (1<<BIT3);
	PORTD &= ~(1<<BIT3);

	//Low-Teil senden
	tmp=data;
	tmp &= 0x0f;
	tmp *= 16;
	tmp |= rs;
	PORTD=tmp;

	//Schreibsignal
	PORTD |= (1<<BIT3);
	PORTD &= ~(1<<BIT3);

	//verarbeiten lassen
	wait_ms(1);
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_cmd(...) - sendet ein Kommando an LCD
//	PE:	cmd= Kommando-Byte
//--------------------------------------------------------------------------------------------------------------
/*void lcd_cmd(char cmd)
{
	PORTD &= ~(1<<BIT2);	//RS löschen = Kommando folgt
	lcd_send(cmd);			//senden;
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_clear(...) - löscht die Anzeige im LCD
//--------------------------------------------------------------------------------------------------------------
/*void lcd_clear()
{
	lcd_cmd(0x01);
	wait_ms(2);		//warten
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
// lcd_home(...) - Cursor auf Position 1,1
//--------------------------------------------------------------------------------------------------------------
/*void lcd_home()
{
	lcd_cmd(0x02);
	wait_ms(2);		//warten
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_on(...) - schaltet das LCD an
//--------------------------------------------------------------------------------------------------------------
/*void lcd_on()
{
	lcd_cmd(0x0E);
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_off(...) - schaltet das LCD aus
//--------------------------------------------------------------------------------------------------------------
/*void lcd_off()
{
	lcd_cmd(0x08);
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_goto(...) - setzt die Cursorposition
//	PE: 	row = Zeile 1/2
//			col = Spalte 1..16
//--------------------------------------------------------------------------------------------------------------
/*void lcd_goto(int row, int col)
{
	row--;					//Null-basierend
	row &= 0x01;			//sicherheitshalber
	row *=40;				//Zeile nach Bit 6 bringen
	col--;					//Null-basierend
	col &= 0x0f;			// sicherheitshalber
	char tmp = row | col;	//Adresse bilden
	tmp |= 0x80;			//Cursor setzen
	lcd_cmd(tmp);			//senden
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_light(...) - schaltet die LCD Hindergrundbeleuchtung ein oder aus
// 	PE: on_off=0...1 = Beleuchtung Aus- bzw. Einschalten
//--------------------------------------------------------------------------------------------------------------
/*
void lcd_light(bool on_off)
{
	//wenn dimmer an -> PWM deinit
	if (lcd_dimmer_is_init)
	{
		TCCR1A=0;
		lcd_dimmer_is_init=false;
	}

	DDRB |= (1<<BIT1);		//PortB1 als Ausgang
	if(on_off)
		PORTB |= (1<<BIT1);	//an

	else
		PORTB &= ~(1<<BIT1);//aus
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_dimmer(...) - legt die Helligkeit der Hintergrundbeleuchtung fest
//	PE: light = 0..255 Helligkeit der Anzeige
//--------------------------------------------------------------------------------------------------------------
/*
void lcd_dimmer(char light)
{	
	//init
	if (!lcd_dimmer_is_init)
	{
		DDRB |= (1<<BIT1);		//Port B.1 als Ausgang
		TCCR1A=0x81;			//PWM Mode 1, Channel A
		TCCR1B=0x02;			//PWM Frequenz CLK/8
		lcd_dimmer_is_init=true;
	}
	OCR1A=light;		//PWM Vergleichswert
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_write(...) - sendet ein Zeichen (Daten) an das LCD
//	PE: 	text=Zeichen
//--------------------------------------------------------------------------------------------------------------
/*void lcd_write(char text)
{
	PORTD |= (1<<BIT2);		//RS setzen = Daten
	lcd_send(text);
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//	lcd_init(...) - Initialisiert das myAVR LCD 16x2, 4 Bit Modus
//	PE: keine
//	PA: keine
//--------------------------------------------------------------------------------------------------------------
/*void lcd_init()
{
	//Port D = Ausgang
	DDRD = 0x0ff;
	PORTD = 0;
	
	//warten bis LCD-Controller gebootet
	wait_ms(50);

	//4-BitModus einschalten
	PORTD = 0x20;

	//Schreibsignal Enable-Impuls
	PORTD |= (1<<BIT3);
	PORTD &= ~(1<<BIT3);

	//Zeit zum Umschalten lassen
	wait_ms(5);

	//ab hier im 4-Bit Modus
	//Funktions-Set: 2 Zeilen, 5x7 Matrix, 4 Bit
	lcd_cmd(0x28);
	lcd_off();
	lcd_clear();

	//Entry Mode
	lcd_cmd(0x06);
	lcd_on();
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
// 	lcd_write(...) - sendet eine Zeichenkette an das LCD
//	Die Zeichenkette muss mit 0x00 abgeschlossen sein
//	PE:	pText=Zeiger auf Zeichenkette
//--------------------------------------------------------------------------------------------------------------
/*void lcd_write(char* pText)
{
	while(pText[0] != 0)
	{
		lcd_write(pText[0]);
		pText++;
	}
}*/
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------






//--------------------------------------------------------------------------------------------------------------
int main (void)
{	
	char d=0;
	wait_ms(200);
	lcd_init();
	while(1)	//Mainloop
	{
		//lcd_dimmer(d+=5);
		lcd_write("H");
		wait_ms(100);
	}


	return 0;
}













